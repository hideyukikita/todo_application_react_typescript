# 詳細設計書

## 2.1 データベース物理設計 (PostgreSQL / Prisma)
### User（ユーザー）
| カラム名 | 型 | 制約 | 説明 |
|---------| --- | ----- | ------ |
| id | UUID | PK | 主キー |
| email | String | Unique, Not Null | ログイン用メールアドレス |
| password | String | Not Null | ハッシュ化されたパスワード |
| name | String | Not Null | 表示名 |

### Todo（タスク）
| カラム名 | 型 | 制約 | 説明 |
|---------| --- | ----- | ---- |
| id | UUID | PK | タスク識別子 |
| user_id | UUID | FK | user.idへリレーション |
| title | String | Not Null | タスク名(最大50文字) |
| memo | String | Nullable | 詳細メモ(最大200文字) |
| priority | Enum型 | Not Null | `HIGH`,`MEDIUM`,`LOW` |
| deadline | DateTime | Not Null | 締切日(時刻含む) |
| is_completed | Boolean | Default:false | 完了状態 |
| created_at | DateTime | Default:now | 作成日時 |
| deleted_at | DateTime | Nullable | 論理削除日時(Null以外は削除済み) ※論理削除対応のため、すべてのSELECTクエリに WHERE deleted_at IS NULL を付与する|


## 2.2 APIエンドポイント設計
| メソッド | パス |	説明 | 認証 |
| -------- | ---- | ----- | ---- |
| `POST` | `/api/auth/signup` |	ユーザー新規登録 | 不要 |
| `POST` | `/api/auth/login` | ログイン（トークン発行） | 不要 |
| `GET` | `/api/todos` | ログインユーザーのタスク一覧取得 | 必要 |
| `POST` | `/api/todos` | タスクの新規登録 | 必要 |
| `PUT` | `/api/todos/:id` | タスクの更新（完了フラグ含む） | 必要 |
| `DELETE` | `/api/todos/:id` | タスクの論理削除 | 必要 |
| `GET` | `/api/todos/stats` | 可視化用の統計データ(日別完了数など)を取得 | 必要 |

## 2.3 バリデーション設計 (Zod)
- `shared/index.ts` に定義し、フロントとバックで共用します。
  - Title: 1文字以上50文字以内。
  - Memo: 200文字以内。
  - Priority: `'HIGH' | 'MEDIUM' | 'LOW'` のいずれか。
  - Deadline: 有効な日付形式かつ、作成時は「今日以降」であること。

## 2.4 フロントエンド構成
1. 画面遷移
   - Auth画面: ログイン / 新規登録のトグル切り替え。
2. Dashboard画面:
   - Rechartsによる統計グラフ。
   - 直近の締切タスク（トップ5）を表示。
3. TodoList画面:
   - 全タスクの一覧。
   - ソート（締切順・優先度順）、フィルタ（全て・未完了・完了）。

### 共通コンポーネント
- `TodoItem`: タスクの1行分。優先度に応じたカラーバッジを表示。
- `TodoForm`: 登録・編集兼用のモーダル。Zodで入力エラーを表示。
- `Layout`: サイドバー、ヘッダー（ログアウトボタン等）。

## 2.5 インフラ設計 (Docker)
- Frontend Container: Vite (ポート: 5173 / `--host` 設定)
- Backend Container: Node.js/Express (ポート: 3000)
- DB Container: PostgreSQL 16 (ポート: 5432)
- Network: `bridge` ネットワークで各コンテナを連携。
- CORS設定: Expressに cors ミドルウェアを導入し、同一WiFi内の他デバイスからのリクエストを許可する。
- 接続先管理: フロントエンドの環境変数（.env）にて、APIの接続先を localhost ではなく「ホストPCのローカルIPアドレス」に設定可能とする。